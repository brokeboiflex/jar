{"version":3,"file":"index.umd.js","sources":["../src/router.tsx"],"sourcesContent":["import { createJSONStorage, persist, StateStorage } from \"zustand/middleware\";\r\nimport { create } from \"zustand\";\r\nimport { ComponentChildren, isValidElement } from \"preact\";\r\nexport interface RouterProps {\r\n  children: ComponentChildren;\r\n  routerStore: () => RouterState;\r\n}\r\nexport interface RouteProps {\r\n  path: string;\r\n  component: ComponentChildren;\r\n}\r\n\r\nexport interface RouterState {\r\n  history: string[];\r\n  location: string;\r\n  navigate: (route: string) => void;\r\n  goBack: () => void;\r\n}\r\n\r\nexport interface LinkProps {\r\n  to: string;\r\n  children: ComponentChildren;\r\n}\r\n\r\nexport function createLink(routerStore: () => RouterState) {\r\n  return function Link({ to, children }: LinkProps) {\r\n    const { navigate } = routerStore();\r\n    return (\r\n      <a\r\n        href=\"\"\r\n        onClick={(e) => {\r\n          e.preventDefault();\r\n          navigate(to);\r\n        }}\r\n      >\r\n        {children}\r\n      </a>\r\n    );\r\n  };\r\n}\r\nexport function createRouterStore(\r\n  storage: StateStorage,\r\n  key?: string\r\n): () => RouterState {\r\n  // @ts-ignore\r\n  return create(\r\n    persist(\r\n      (set) => ({\r\n        history: [\"/\"],\r\n        location: \"/\", // Default route\r\n        navigate: (route: string) =>\r\n          set((state: RouterState) => ({\r\n            history: [...state.history, route],\r\n            location: route,\r\n          })),\r\n        goBack: () =>\r\n          set((state: RouterState) => ({\r\n            location: state.history[state.history.length - 1],\r\n            history: [...state.history].slice(0, -1),\r\n          })),\r\n      }),\r\n      {\r\n        name: `router-storage${key ? \"-\" + key : \"\"}`,\r\n        storage: createJSONStorage(() => storage),\r\n      }\r\n    )\r\n  );\r\n}\r\nexport function Router({ children, routerStore }: RouterProps) {\r\n  const { location } = routerStore();\r\n  console.log(location);\r\n\r\n  // Filter children to get Route components\r\n  const routes = Array.isArray(children) ? children : [children];\r\n  const routeElements = routes.filter(\r\n    (child) => isValidElement(child) && (child as any).type === Route\r\n  );\r\n\r\n  // Find the component that matches the current route\r\n  const currentRoute = routeElements.find((route) => {\r\n    const routeProps = (route as any).props as RouteProps;\r\n    return routeProps.path === location;\r\n  });\r\n\r\n  return currentRoute ? (currentRoute as any).props.component : null;\r\n}\r\n\r\n// Route component\r\n// @ts-ignore\r\nexport function Route({ path, component }: RouteProps) {\r\n  return null;\r\n}\r\n"],"names":["Route","_ref3","_ref2","children","location","routerStore","console","log","currentRoute","Array","isArray","filter","child","isValidElement","type","find","route","props","path","component","_ref","to","navigate","_jsx","href","onClick","e","preventDefault","storage","key","create","persist","set","history","state","concat","goBack","length","slice","name","createJSONStorage"],"mappings":"+bAyFgBA,EAAKC,GACnB,OACF,IAAA,6BAvBsBC,GAAuC,IAApCC,EAAQD,EAARC,SACfC,GAAaC,EADuBH,EAAXG,eACzBD,SACRE,QAAQC,IAAIH,GAGZ,IAMMI,GANSC,MAAMC,QAAQP,GAAYA,EAAW,CAACA,IACxBQ,OAC3B,SAACC,GAAK,OAAKC,EAAAA,eAAeD,IAAWA,EAAcE,OAASd,CAAK,GAIhCe,KAAK,SAACC,GAEvC,OADoBA,EAAcC,MAChBC,OAASd,CAC7B,GAEA,OAAOI,EAAgBA,EAAqBS,MAAME,UAAY,IAChE,wBA7D2Bd,GACzB,OAAO,SAAae,GAA4B,IAAzBC,EAAED,EAAFC,GAAIlB,EAAQiB,EAARjB,SACjBmB,EAAajB,IAAbiB,SACR,OACEC,EAAAA,IACE,IAAA,CAAAC,KAAK,GACLC,QAAS,SAACC,GACRA,EAAEC,iBACFL,EAASD,EACX,EAEClB,SAAAA,GAGP,CACF,+BAEEyB,EACAC,GAGA,OAAOC,EAAAA,OACLC,EAAOA,QACL,SAACC,GAAG,MAAM,CACRC,QAAS,CAAC,KACV7B,SAAU,IACVkB,SAAU,SAACN,GACT,OAAAgB,EAAI,SAACE,GAAwB,MAAA,CAC3BD,QAAOE,GAAAA,OAAMD,EAAMD,QAASjB,CAAAA,IAC5BZ,SAAUY,EACX,EAAE,EACLoB,OAAQ,WACN,OAAAJ,EAAI,SAACE,GAAwB,MAAA,CAC3B9B,SAAU8B,EAAMD,QAAQC,EAAMD,QAAQI,OAAS,GAC/CJ,QAAS,GAAAE,OAAID,EAAMD,SAASK,MAAM,GAAI,GACvC,EAAE,EACN,EACD,CACEC,uBAAuBV,EAAM,IAAMA,EAAM,IACzCD,QAASY,EAAiBA,kBAAC,WAAA,OAAMZ,CAAO,KAIhD"}